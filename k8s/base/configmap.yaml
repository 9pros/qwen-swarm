apiVersion: v1
kind: ConfigMap
metadata:
  name: qwen-swarm-config
  labels:
    app: qwen-swarm
data:
  db-type: "postgresql"
  db-host: "postgres-service"
  db-port: "5432"
  redis-enabled: "true"
  redis-host: "redis-service"
  redis-port: "6379"
  log-level: "info"
  api-port: "3000"
  api-host: "0.0.0.0"
  ws-port: "3001"
  ws-host: "0.0.0.0"
  monitoring-enabled: "true"
  metrics-interval: "30000"
  health-check-interval: "30000"
  learning-enabled: "true"
  learning-algorithm: "hybrid"
  learning-rate: "0.01"
  exploration-rate: "0.1"
  rate-limit-window-ms: "60000"
  rate-limit-max-requests: "100"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: qwen-swarm-app-config
  labels:
    app: qwen-swarm
data:
  config.json: |
    {
      "system": {
        "name": "Qwen Swarm",
        "version": "1.0.0",
        "environment": "production",
        "maxAgents": 50,
        "autoScaling": true
      },
      "api": {
        "port": 3000,
        "host": "0.0.0.0",
        "cors": true,
        "rateLimit": {
          "windowMs": 60000,
          "maxRequests": 100
        }
      },
      "websocket": {
        "port": 3001,
        "host": "0.0.0.0",
        "path": "/ws"
      },
      "security": {
        "authenticationRequired": true,
        "encryptionEnabled": false,
        "auditEnabled": true,
        "allowedOrigins": ["https://yourdomain.com", "https://api.yourdomain.com"]
      },
      "learning": {
        "enabled": true,
        "algorithm": "hybrid",
        "learningRate": 0.01,
        "explorationRate": 0.1
      },
      "monitoring": {
        "enabled": true,
        "metricsInterval": 30000,
        "healthCheckInterval": 30000
      }
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  labels:
    app: qwen-swarm
    component: nginx
data:
  nginx.conf: |
    upstream qwen_swarm_backend {
        server qwen-swarm-service:80;
    }

    upstream qwen_swarm_websocket {
        server qwen-swarm-service:3001;
    }

    server {
        listen 80;
        server_name _;

        # Redirect HTTP to HTTPS
        return 301 https://$server_name$request_uri;
    }

    server {
        listen 443 ssl http2;
        server_name _;

        ssl_certificate /etc/nginx/ssl/tls.crt;
        ssl_certificate_key /etc/nginx/ssl/tls.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        # Security headers
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        # API routes
        location /api/ {
            proxy_pass http://qwen_swarm_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
        }

        # Health checks
        location /health {
            proxy_pass http://qwen_swarm_backend;
            proxy_set_header Host $host;
            proxy_connect_timeout 5s;
            proxy_send_timeout 5s;
            proxy_read_timeout 5s;
        }

        location /ready {
            proxy_pass http://qwen_swarm_backend;
            proxy_set_header Host $host;
            proxy_connect_timeout 5s;
            proxy_send_timeout 5s;
            proxy_read_timeout 5s;
        }

        location /metrics {
            proxy_pass http://qwen_swarm_backend;
            proxy_set_header Host $host;
            allow 127.0.0.1;
            allow 10.0.0.0/8;
            allow 172.16.0.0/12;
            allow 192.168.0.0/16;
            deny all;
        }

        # WebSocket routes
        location /ws {
            proxy_pass http://qwen_swarm_websocket;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_read_timeout 86400s;
            proxy_send_timeout 86400s;
        }

        # Frontend static files
        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri $uri/ /index.html;

            # Cache static assets
            location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
                expires 1y;
                add_header Cache-Control "public, immutable";
            }
        }
    }